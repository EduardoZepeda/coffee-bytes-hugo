{{ if false }}

{{/* Load the ads dictionary from the data directory */}}
{{ $ads := $.Site.Data.ads_data }}
{{/* Detect the current page's language */}}
{{ $lang := .Page.Language.Lang }}
{{ $langAds := index $ads $lang }}
{{/* Fallback to English if no ads exist for the detected language */}}
{{ if not $langAds }}
  {{ $langAds = index $ads (.LanguagePrefix | absURL) }}
{{ end }}
{{ if not (.Site.Params.latte.HideAds) }}
<style>
  .affiliate-heading {
      display:flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
 }
  .affiliate-badge{
      opacity: 0.75;
      font-size: 0.90rem;
      word-break: keep-all;
 }
  .affiliate-img-side {
      max-height: 225px;
      width: 100%;
 }
  .affiliate-img {
      width: 450px;
      width: 100%;
 }
  .affiliate-link-button-sm {
      display:none;
 }
  .affiliate-link-button-lg {
      display:block;
 }
 .affiliate-link-button-sm:visited, .affiliate-link-button-lg:visited {
     color: var(--dark);
 }
 
  .affiliate-link-container {
      margin-bottom: 36px;
      padding: 0 2rem;
      position: sticky;
      top: 120px;
 }
  .affiliate-body{
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 24px;
      margin-top: 36px;
      margin-bottom: 36px;
 }
 .affiliate-desc {
      opacity: 0.90;
      width: 100%;
  }

  .affiliate-link-button{
      background-color: #FED400;
      color: #020100;
      padding: 6px 22px;
      border-radius: 4px;
 }
 
   .affiliate-shadow {
     box-shadow: 7px 6px 39px -15px rgba(46,46,46,0.75);
     -webkit-box-shadow: 7px 6px 39px -15px rgba(46,46,46,0.75);
     -moz-box-shadow: 7px 6px 39px -15px rgba(46,46,46,0.75);
   }
   .affiliate-link-container-article{
      display: none;
  }
  @media (max-width: 720px) {
      .affiliate-link-button{
          padding: 8px 24px;
          border-radius: 4px;
     }
      .affiliate-link-button-sm {
          display:block;
     }
      .affiliate-link-button-lg {
          display:none;
     }
      .affiliate-img {
          width: 225px;
          aspect-ratio: 34/45;
      }
      .affiliate-shadow {
        box-shadow: none;
        -webkit-box-shadow: none;
        -moz-box-shadow: none;
      }
      .affiliate-body {
        margin-top: 0;
        margin-bottom: 96px;
      }

 }
 
 @media (max-width: 1120px) {
   .affiliate-link-container-side {
     display: none;
   }
   .affiliate-link-container-article {
     display: inline;
   }
  .affiliate-link-container{
      position:relative;
      top:0;
    }
 }

 .video-placeholder {
  width: 100%;
  max-width: 460px;
  position: relative;
  cursor: pointer;
  display: inline-block;
}

.panel-button{
  text-align: center;
}

.video-thumbnail {
  display: block;
  width: 100%;
  height: auto;
}

.play-button {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 68px;
  height: 48px;
  background: #333;
  border-radius: 12px;
  opacity: 0.8;
}

.play-button::before {
  content: "";
  position: absolute;
  left: 24px;
  top: 9px;
  border: 16px solid transparent;
  border-left: 24px solid #fff;
}

.video-placeholder:hover .play-button {
  background: #f00;
  opacity: 1;
}

</style>
{{/* Loop through categories and display ads, limit only to two categories */}}
{{ range first 2 .Page.Params.categories }}
  {{ $ad := index $langAds (lower .) }}
  {{ if $ad }}
  <aside class="affiliate-link-container-article affiliate-link-container">
    <div class="affiliate-heading">
      <h2>{{$ad.title}}</h2>
      <span class="affiliate-badge">{{ i18n "ad" }}</span>
    </div>
    <div class="affiliate-body">
    <div><p>{{$ad.description}}</p></div>
    {{ if $ad.imageSrc }}
      <div>
      <img fetchpriority="high" class="affiliate-img affiliate-shadow" src="{{$ad.imageSrc}}" alt="{{$ad.imageAlt}}"/>
      </div>
    {{ end }}
      <div>
        <a rel="nofollow sponsored" category="{{.}}" class="affiliate-link affiliate-link-button affiliate-link-button-lg affiliate-shadow" aria-label="Amazon link" href="{{$ad.link}}">{{$ad.linkText}}</a>
        {{/*  Show shorter link according to media queries  */}}
        <a rel="nofollow sponsored" category="{{.}}" class="affiliate-link affiliate-link-button affiliate-link-button-sm affiliate-shadow" aria-label="Amazon link" href="{{$ad.link}}">{{ T "amazonLink"}}</a>
      </div>
    </div>
  </aside>
    {{ end }}
  {{ end }}

  <template id="books-template">
    <aside class="affiliate-link-container affiliate-link-container-side affiliate-link-container">
      <div class="affiliate-heading">
        <h5>{{i18n "bookRecommendations"}}</h5>
        <span class="affiliate-badge">{{ i18n "ad" }}</span>
      </div>
      <div class="affiliate-desc">{{i18n "bookDescriptions"}}</div>
      {{/* Loop through categories and display ads, limit only to two categories */}}
      {{ range first 2 .Page.Params.categories }}
        {{ $ad := index $langAds . }}
        {{ if $ad }}
            <div class="affiliate-body">
            {{ if $ad.imageSrc }}
              <div>
              <img fetchpriority="high" class="affiliate-img-side affiliate-shadow" height="225px" src="{{$ad.imageSrc}}" alt="{{$ad.imageAlt}}"/>
              </div>
            {{ end }}
              <div>
                <a rel="nofollow sponsored" category="{{.}}" class="affiliate-link affiliate-link-button affiliate-link-button-lg affiliate-shadow" aria-label="Amazon link" href="{{$ad.link}}">{{ T "amazonLink"}}</a>
              </div>
            </div>
        {{ end }}
      {{ end }}
    </aside>
  </template>

  <template id="sass-template">
    <aside class="affiliate-link-container affiliate-link-container-side">
      <div class="affiliate-heading">
        <h5>{{i18n "leftPanelTitle"}}</h5>
      </div>
        {{ $url := "/en/my-curated-best-sources-to-learn-python-programming-language/" }}
        {{ if eq $lang "es" }}
              {{ $url = "/es/mis-libros-favoritos-para-aprender-a-programar-en-python/" }}
        {{ end }}
      <div class="affiliate-body">
        <div class="affiliate-desc">{{i18n "leftPanelDesc"}}</div>
        <div class="video-placeholder" data-video-id="0QkuLx6UiXk" data-image-url="https://res.cloudinary.com/dwrscezd2/image/upload/v1744741603/coffee-bytes/saas-pegasus_uwpzuy.webp">
            <img fetchpriority="high" height="200px" width="472px" src="https://res.cloudinary.com/dwrscezd2/image/upload/v1745688775/coffee-bytes/python-tricks_zjtir8.webp" alt="Python book thumbnail" class="video-thumbnail"/>
        </div>
        <div class="panel-button"><a class="affiliate-link affiliate-link-button affiliate-link-button-lg affiliate-shadow" href="{{$url}}">{{ i18n "leftPanelButton"}}</a></div>
          <h5>{{i18n "do"}}</h5>
          <a rel="sponsored nofollow" href="https://www.digitalocean.com/?refcode=a22240ebb8e7&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge%203.svg" alt="DigitalOcean Referral Badge" /></a>
      </div>
    </aside>
  </template>

  <div id="right-panel-placeholder" class="affiliate-placeholder" style="min-height: 400px;"></div>
  <div id="left-panel-placeholder" class="affiliate-placeholder" style="min-height: 400px;"></div>

<style>
  .affiliate-placeholder {
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 4px;
    margin-bottom: 1rem;
  }
  
  @keyframes shimmer {
    0% { background-position: 200% 0; }
    100% { background-position: -200% 0; }
  }
</style>

<script defer type="module">
  // Track if ads have been rendered to prevent duplication
  let adsRendered = false;
  
  function renderPanel(templateId, panelId) {
    const template = document.getElementById(templateId);
    const panel = document.getElementById(panelId);
    const placeholder = document.getElementById(`${panelId}-placeholder`);
    
    if (!template || !panel || !placeholder) return;
    
    // Clear existing content except the placeholder
    panel.innerHTML = '';
    panel.appendChild(placeholder);
    
    // Clone and append template content
    const clone = template.content.cloneNode(true);
    panel.appendChild(clone);
    
    // Remove placeholder after content is rendered
    placeholder.remove();
  }

  function renderAds() {
    if (adsRendered) return;
    
    renderPanel('books-template', 'right-panel');
    renderPanel('sass-template', 'left-panel');
    
    adsRendered = true;
  }

  async function updateLinkToMx() {
    try {
      const response = await fetch("/data/ads.json");
      const adsData = await response.json();
      const affiliateLinks = document.querySelectorAll(".affiliate-link[category]");
      
      affiliateLinks.forEach((link) => {
        const category = link.getAttribute("category");
        if (category && adsData["es-MX"] && adsData["es-MX"][category]) {
          link.setAttribute("href", adsData["es-MX"][category]["link"]);
        }
      });
    } catch (error) {
      console.error("Error updating MX links:", error);
    }
  }

  function shouldUpdateToMx() {
    return Intl.DateTimeFormat().resolvedOptions().timeZone === "America/Mexico_City" && 
           document.documentElement.lang === "es";
  }

  function handleContentLoad() {
    // Reset rendered state on each load
    adsRendered = false;
    renderAds();
    
    if (shouldUpdateToMx()) {
      updateLinkToMx();
    }
  }

  // HTMX event listeners
  document.body.addEventListener('htmx:afterSettle', handleContentLoad);
  document.body.addEventListener('htmx:historyRestore', handleContentLoad);

  // Initial load
  if (document.readyState !== 'loading') {
    handleContentLoad();
  } else {
    document.addEventListener('DOMContentLoaded', handleContentLoad);
  }
</script>

{{ end }}
{{ end }}