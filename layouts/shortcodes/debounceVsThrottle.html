

<div id="debounce-throttle-root"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>

<style>
.demo-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 20px;
  font-family: 'Arial', sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  border-radius: 15px;
  color: white;
}

.title {
  text-align: center;
  font-size: 2.5rem;
  margin-bottom: 10px;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}

.subtitle {
  text-align: center;
  font-size: 1.1rem;
  margin-bottom: 30px;
  opacity: 0.9;
}

.panels-container {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
  margin-bottom: 30px;
}

.panel {
  background: rgba(255, 255, 255, 0.1);
  border-radius: 12px;
  padding: 20px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  transition: transform 0.3s ease;
}

.panel:hover {
  transform: translateY(-2px);
}

.panel-title {
  font-size: 1.5rem;
  margin-bottom: 15px;
  text-align: center;
  font-weight: bold;
}

.farmyard {
  height: 200px;
  background: linear-gradient(to bottom, #87CEEB 0%, #98FB98 50%, #228B22 100%);
  border-radius: 8px;
  position: relative;
  overflow: hidden;
  border: 2px solid #8B4513;
  margin-bottom: 15px;
}

.fence {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  height: 30px;
  background: repeating-linear-gradient(
    90deg,
    #8B4513 0px,
    #8B4513 8px,
    #D2691E 8px,
    #D2691E 12px
  );
}

.animal {
  position: absolute;
  font-size: 2rem;
  transition: all 0.3s ease;
  cursor: pointer;
}

.animal.entering {
  animation: bounce 0.5s ease;
}

@keyframes bounce {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.2); }
}

.control-panel {
  background: rgba(0, 0, 0, 0.1);
  padding: 15px;
  border-radius: 8px;
  margin-bottom: 15px;
}

.input-group {
  margin-bottom: 15px;
}

.input-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: bold;
}

.input-group input {
  width: 100%;
  padding: 8px;
  border: none;
  border-radius: 4px;
  font-size: 1rem;
}

.stats {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  font-size: 0.9rem;
}

.stat-item {
  background: rgba(0, 0, 0, 0.2);
  padding: 8px;
  border-radius: 4px;
  text-align: center;
}

.explanation {
  background: rgba(255, 255, 255, 0.1);
  padding: 20px;
  border-radius: 12px;
  backdrop-filter: blur(10px);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.explanation h3 {
  margin-top: 0;
  color: #FFD700;
}

@media (max-width: 768px) {
  .panels-container {
    grid-template-columns: 1fr;
  }
  
  .title {
    font-size: 2rem;
  }
  
  .stats {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
const { useState, useEffect, useCallback, useRef } = React;

const animals = ['üêÑ', 'üêë', 'üê∑', 'üêì', 'üêé', 'üêê', 'ü¶Ü', 'üê∞'];

function DebounceThrottleDemo() {
  const [debounceDelay, setDebounceDelay] = useState(500);
  const [throttleDelay, setThrottleDelay] = useState(500);
  const [inputValue, setInputValue] = useState('');
  
  const [debounceAnimals, setDebounceAnimals] = useState([]);
  const [throttleAnimals, setThrottleAnimals] = useState([]);
  
  const [debounceStats, setDebounceStats] = useState({ calls: 0, executions: 0 });
  const [throttleStats, setThrottleStats] = useState({ calls: 0, executions: 0 });
  
  const debounceTimeoutRef = useRef(null);
  const throttleLastExecRef = useRef(0);
  const throttleTimeoutRef = useRef(null);

  // Debounce function
  const debounce = useCallback((func, delay) => {
    return (...args) => {
      setDebounceStats(prev => ({ ...prev, calls: prev.calls + 1 }));
      
      clearTimeout(debounceTimeoutRef.current);
      debounceTimeoutRef.current = setTimeout(() => {
        func(...args);
        setDebounceStats(prev => ({ ...prev, executions: prev.executions + 1 }));
      }, delay);
    };
  }, []);

  // Throttle function
  const throttle = useCallback((func, delay) => {
    return (...args) => {
      setThrottleStats(prev => ({ ...prev, calls: prev.calls + 1 }));
      
      const now = Date.now();
      
      if (now - throttleLastExecRef.current >= delay) {
        func(...args);
        setThrottleStats(prev => ({ ...prev, executions: prev.executions + 1 }));
        throttleLastExecRef.current = now;
      }
    };
  }, []);

  // Add animal to farmyard
  const addAnimalToFarmyard = (setAnimals) => {
    const animal = animals[Math.floor(Math.random() * animals.length)];
    const id = Date.now() + Math.random();
    const newAnimal = {
      id,
      emoji: animal,
      x: Math.random() * 80 + 5,
      y: Math.random() * 60 + 20
    };

    setAnimals(prev => [...prev, newAnimal]);
    
    // Remove animal after 2 seconds
    setTimeout(() => {
      setAnimals(prev => prev.filter(a => a.id !== id));
    }, 2000);
  };

  // Create debounced and throttled functions
  const debouncedAddAnimal = useCallback(
    debounce(() => addAnimalToFarmyard(setDebounceAnimals), debounceDelay),
    [debounce, debounceDelay]
  );

  const throttledAddAnimal = useCallback(
    throttle(() => addAnimalToFarmyard(setThrottleAnimals), throttleDelay),
    [throttle, throttleDelay]
  );

  // Handle input change
  const handleInputChange = (e) => {
    const value = e.target.value;
    setInputValue(value);
    
    // Trigger both debounced and throttled functions
    debouncedAddAnimal();
    throttledAddAnimal();
  };

  // Reset stats when delays change
  useEffect(() => {
    setDebounceStats({ calls: 0, executions: 0 });
  }, [debounceDelay]);

  useEffect(() => {
    setThrottleStats({ calls: 0, executions: 0 });
  }, [throttleDelay]);

  const resetDemo = () => {
    setInputValue('');
    setDebounceAnimals([]);
    setThrottleAnimals([]);
    setDebounceStats({ calls: 0, executions: 0 });
    setThrottleStats({ calls: 0, executions: 0 });
    clearTimeout(debounceTimeoutRef.current);
    clearTimeout(throttleTimeoutRef.current);
  };

  return React.createElement('div', { className: 'demo-container' },
    React.createElement('h3', { className: 'title' }, 'üöú Farmyard Demo: Debounce vs Throttle'),
    React.createElement('p', { className: 'subtitle' }, 
      'Type in the input below to see how debounce and throttle control when animals appear in the farmyard!'
    ),
    
    React.createElement('div', { className: 'panels-container' },
      // Debounce Panel
      React.createElement('div', { className: 'panel' },
        React.createElement('h4', { className: 'panel-title' }, 'üêå Debounce'),
        React.createElement('div', { className: 'farmyard' },
          React.createElement('div', { className: 'fence' }),
          ...debounceAnimals.map(animal =>
            React.createElement('div', {
              key: animal.id,
              className: 'animal entering',
              style: {
                left: `${animal.x}%`,
                top: `${animal.y}%`
              }
            }, animal.emoji)
          )
        ),
        React.createElement('div', { className: 'control-panel' },
          React.createElement('div', { className: 'input-group' },
            React.createElement('label', null, `Delay: ${debounceDelay}ms`),
            React.createElement('input', {
              type: 'range',
              min: 100,
              max: 1000,
              step: 50,
              value: debounceDelay,
              onChange: (e) => setDebounceDelay(parseInt(e.target.value))
            })
          ),
          React.createElement('div', { className: 'stats' },
            React.createElement('div', { className: 'stat-item' },
              React.createElement('div', null, 'Function Calls'),
              React.createElement('strong', null, debounceStats.calls)
            ),
            React.createElement('div', { className: 'stat-item' },
              React.createElement('div', null, 'Animals Spawned'),
              React.createElement('strong', null, debounceStats.executions)
            )
          )
        )
      ),
      
      // Throttle Panel
      React.createElement('div', { className: 'panel' },
        React.createElement('h4', { className: 'panel-title' }, '‚ö° Throttle'),
        React.createElement('div', { className: 'farmyard' },
          React.createElement('div', { className: 'fence' }),
          ...throttleAnimals.map(animal =>
            React.createElement('div', {
              key: animal.id,
              className: 'animal entering',
              style: {
                left: `${animal.x}%`,
                top: `${animal.y}%`
              }
            }, animal.emoji)
          )
        ),
        React.createElement('div', { className: 'control-panel' },
          React.createElement('div', { className: 'input-group' },
            React.createElement('label', null, `Delay: ${throttleDelay}ms`),
            React.createElement('input', {
              type: 'range',
              min: 100,
              max: 1000,
              step: 50,
              value: throttleDelay,
              onChange: (e) => setThrottleDelay(parseInt(e.target.value))
            })
          ),
          React.createElement('div', { className: 'stats' },
            React.createElement('div', { className: 'stat-item' },
              React.createElement('div', null, 'Function Calls'),
              React.createElement('strong', null, throttleStats.calls)
            ),
            React.createElement('div', { className: 'stat-item' },
              React.createElement('div', null, 'Animals Spawned'),
              React.createElement('strong', null, throttleStats.executions)
            )
          )
        )
      )
    ),
    
    // Input Control
    React.createElement('div', { className: 'control-panel', style: { marginBottom: '20px' } },
      React.createElement('div', { className: 'input-group' },
        React.createElement('label', null, 'üåæ Type here to trigger animal spawning:'),
        React.createElement('input', {
          type: 'text',
          value: inputValue,
          onChange: handleInputChange,
          placeholder: 'Start typing to see the magic happen...',
          style: { fontSize: '1.1rem', padding: '12px' }
        })
      ),
      React.createElement('button', {
        onClick: resetDemo,
        style: {
          padding: '10px 20px',
          backgroundColor: '#FF6B6B',
          color: 'white',
          border: 'none',
          borderRadius: '6px',
          cursor: 'pointer',
          fontSize: '1rem',
          marginTop: '10px'
        }
      }, 'üîÑ Reset Demo')
    ),
    
    // Explanation
    React.createElement('div', { className: 'explanation' },
      React.createElement('h3', null, 'üìö How it Works'),
      React.createElement('p', null, 
        React.createElement('strong', null, 'üêå Debounce: '),
        'Waits for a pause in activity before executing. Animals only appear after you stop typing for the specified delay. Perfect for search suggestions or API calls.'
      ),
      React.createElement('p', null, 
        React.createElement('strong', null, '‚ö° Throttle: '),
        'Executes at most once per time interval, regardless of how many times it\'s called. Animals appear at regular intervals while you type. Great for scroll events or button click protection.'
      ),
      React.createElement('p', null, 
        React.createElement('strong', null, 'üí° Key Difference: '),
        'Debounce resets the timer on each call, while throttle maintains a consistent execution rate. Watch the "Function Calls" vs "Animals Spawned" to see the difference!'
      )
    )
  );
}

function renderFarm(){
    if(!document.getElementById("debounce-throttle-root")){
      document.body.removeEventListener('htmx:afterSettle', renderFarm);
        document.body.removeEventListener('htmx:historyRestore', renderFarm);
    } else {
      document.body.addEventListener('htmx:afterSettle', renderFarm);
      document.body.addEventListener('htmx:historyRestore', renderFarm);
    }
    ReactDOM.render(React.createElement(DebounceThrottleDemo), document.getElementById('debounce-throttle-root'));
}
  renderFarm()
</script>